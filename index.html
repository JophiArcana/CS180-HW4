<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <style>
            body {
                padding: 100px;
                width: 1000px;
                margin: auto;
                text-align: left;
                font-weight: 300;
                font-family: 'Serif', serif;
                color: #121212;
            }
            h1, h2, h3, h4 {
                font-family: 'Source Serif Pro', serif;
            }
        </style>
        <title>CS180 Project 4A</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <link href="https://fonts.googleapis.com/css?family=PT+Serif|Source+Serif+Pro" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"/>
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    </head>
    
    
    <body>
        <h1 align="middle">CS180 Intro to Computer Vision and Computational Photography</h1>
        <h1 align="middle">Project 4A by Wentinn Liao</h1>
        
        <div>
            <h2 align="left">Part 1. Shoot the Pictures</h2>
            <p>A total of 17 pictures over a <b>~300 degree</b> field of view in BAIR labs of Berkeley Way West. The focal length and exposure were locked, and the center of projection was kept consistently as possible by referencing floor tiles and surrounding markings, although due to lack of a tripod there may be up to <b>~2cm</b> of error. Sixteen of them are shown below. The images are indexed from <b>-6</b> to <b>10</b>, where <b>0</b> corresponds to the image with the camera directly facing the window, and the images numbered increasingly from left to right. The choice of scene may be changed to BWW Floor 3 if I have an opportunity for access.</p>
            <div align="middle">
                <img src="images/image_grid.jpg" align="middle" height="720px"/>
                <figcaption align="middle">Sixteen images from Berkeley Way West.</figcaption>
            </div>
            
            
            
            <h2 align="left">Part 2. Recover Homographies</h2>
            <p>The homographies are extracted by stacking the following equation</p>\[
                \begin{bmatrix}
                    x   & y & 1 & 0 & 0 & 0 & -x'x  & -x'y  \\
                    0   & 0 & 0 & x & y & 1 & -y'x  & -y'y'
                \end{bmatrix} \begin{bmatrix}
                    a   \\
                    b   \\
                    c   \\
                    d   \\
                    e   \\
                    f   \\
                    g   \\
                    h
                \end{bmatrix} = \begin{bmatrix}
                    x'  \\
                    y'
                \end{bmatrix}
            \]<p>and solving least squares. The matrix can be constructed very quickly and in short code using NumPy smart indexing.</p>
            
            
            
            <h2 align="left">Part 3. Warp the Images</h2>
            <p>To warp the images, we first augment the corners and warp them to obtain the bounding quadrilateral of the resulting image. This is used to compute the required shape of the image to fit the warp. Additionally, the offset of the image must be saved. I.e., the topleftmost warp will be <b>(0, 0)</b> in the indexing of the image, but was not necessarily the true warp destination. The pixels to be inverse-warped are calculated using <b>sk.draw.polygon</b>, and the inverse-warped pixels are bilinear sampled from the original image. After defining the correspondences between BWW -1 and BWW 0, the result of warping BWW -1 to the perspective of BWW 0 is shown below.</p>
            <div align="middle">
                <table>
                    <tr>
                        <td>
                            <img src="images/warped_imn1.jpg" align="middle" height="360px"/>
                            <figcaption align="middle">Warped BWW Image -1.</figcaption>
                        </td>
                        <td>
                            <img src="code/data/BWW/BWW 0.jpg" align="middle" height="360px"/>
                            <figcaption align="middle">BWW Image 0.</figcaption>
                        </td>
                    </tr>
                </table>
            </div>
            
            
            
            <h2 align="left">Part 4. Image Rectification</h3>
                <p>To compute the rectification, four points known to form a rectangle defined by the windows are selected on BWW image 0. To keep the projection relatively to scale, the target rectangle is calculated by averaging the min and max <b>x</b> and <b>y</b> coordinates. BWW image 0 before and after rectification is shown below along with the rectangle used to define the rectification.</p>
                <div align="middle">
                    <table>
                        <tr>
                            <td>
                                <img src="images/unrectified_im0.jpg" align="middle" height="360px"/>
                                <figcaption align="middle">Unrectified BWW Image 0.</figcaption>
                            </td>
                            <td>
                                <img src="images/rectified_im0.jpg" align="middle" height="360px"/>
                                <figcaption align="middle">Rectified BWW Image 0.</figcaption>
                            </td>
                        </tr>
                    </table>
                </div>
                
                <p>To compute the rectification for other images is slightly different. Although we can employ the same rectification technique, we will need to recover another homography between the two rectified images. Instead, we compute a homography from BWW Image -1 to the perspective of BWW Image 0, and compose it with the rectification homography of Image 0. The resulting homography will then not only rectify Image -1, but also rectify it to the same perspective as the rectified Image 0. The result of performing this rectification is shown below.</p>
                <div align="middle">
                    <table>
                        <tr>
                            <td>
                                <img src="images/unrectified_imn1.jpg" align="middle" height="360px"/>
                                <figcaption align="middle">Unrectified BWW Image -1.</figcaption>
                            </td>
                            <td>
                                <img src="images/rectified_imn1.jpg" align="middle" height="360px"/>
                                <figcaption align="middle">Rectified BWW Image -1.</figcaption>
                            </td>
                        </tr>
                    </table>
                </div>
                
                
                
                <h2 align="left">Part 5. Blend the Images into a Mosaic</h2>
                <p>To obtain the mask, we simply use the distance transform <b>sc.ndimage.distance_transform_edt</b> on the two images and compare the results. To perform the blending, I simply copied code from Project 2 which utilizes Gaussian and Laplacian stacks to perform the blend. Due to the noticeable difference in lighting of the two images, a more aggressive blend makes it look nicer, so a stack depth of <b>4</b> and <b>&#x03C3 = 3</b> (i.e. Gaussian filter size 19) is chosen, making the color transition at the stitch line is slightly smoother.</p>
                <div align="middle">
                    <img src="images/blended_im0_n1.jpg" align="middle" height="720px"/>
                    <figcaption align="middle">Blended and rectified image -1 and 0 with stack depth 4 and &#x03C3 = 3.</figcaption>
                </div>
                
                
                
                <h2 align="left">Tell us what you've learned</h2>
                <p>The most interesting part of this project was realizing how effective and realistic a simple homographic transform can be in "modifying" the camera perspective. It is also interesting to prove that homographic transforms extracted from least squares are inverses. The proof is simple but the result is not as trivial as it seems, because the result of multiplying the homography is not necessarily the target coordinates augmented with <b>w = 1</b>, rather, each point ends up with some random scaling. The result is proven by interpreting this augmentation as a right multiplication by some diagonal matrix.</p> \[
                    H\begin{bmatrix}
                        \vec{x}^\top    \\
                        \vec{y}^\top    \\
                        \vec{1}^\top
                    \end{bmatrix} = \begin{bmatrix}
                        \vec{x}'^\top    \\
                        \vec{y}'^\top    \\
                        \vec{1}^\top
                    \end{bmatrix}D \Rightarrow
                    H^{-1}\begin{bmatrix}
                        \vec{x}'^\top    \\
                        \vec{y}'^\top    \\
                        \vec{1}^\top
                    \end{bmatrix} = \begin{bmatrix}
                        \vec{x}^\top    \\
                        \vec{y}^\top    \\
                        \vec{1}^\top
                    \end{bmatrix}D^{-1}
                \] <p>The resulting equation shows that the inverse homography is indeed a valid homographic transform back to the original points. A similar proof exists to show composition of homographies is not only a homography, but also produces the expected result. In general, the scaling of each augmented point will be a right multiplication by some diagonal matrix, while the homographies will operate on the left, so the actual transformations of the coordinate system will operate independently of the scaling.
        </div>
    </body>
</html>
